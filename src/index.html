<!doctype html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Stencil Component Starter</title>

    <script type="module" src="/build/ask-manager.esm.js"></script>
    <script nomodule src="/build/ask-manager.js"></script>
  </head>
  <body>
    <button onclick="showConsent()">Show consent</button>
    <button onclick="document.querySelector('ask-manager').showBanner()">Change consent</button>
    <button onclick="document.querySelector('ask-manager').deleteConsent()">Delete consent</button>
    <p id="what-is-accepted">You have accepted essential cookies</p>
    <ask-manager></ask-manager>
  </body>
  <script>
    customElements.whenDefined('ask-manager').then(() => {
      document.querySelector('ask-manager').setOptions({
        categories: [
          { key: 'functional', name: 'Functional Cookies', adjective: 'functional', description: 'Required for some of the functionalities of the website' },
          { key: 'analytical', name: 'Analytical Cookies', adjective: 'analytical', description: 'Used to improve the website' },
          { key: 'marketing', name: 'Marketing Cookies', adjective: 'marketing', description: 'Used for targeted advertisement' },
        ],
        cookiePolicyLastUpdated: '2023-09-13',
        linkToPrivacyPolicy: 'https://example.com',
      });
      document.querySelector('ask-manager').addEventListener('consentUpdated', e => {
        e.detail.unshift('essential');
        document.getElementById('what-is-accepted').innerText = `You have accepted ${listToString(e.detail)} cookies`;
      });
    });

    async function showConsent() {
      let consent = ['essential'];
      for (const category of ['functional', 'analytical', 'marketing']) {
        if (await document.querySelector('ask-manager').hasConsent(category)) {
          consent.push(category);
        }
      }
      alert(`You have accepted ${listToString(consent)} cookies`);
    }

    function listToString(list) {
      return list.length == 1 ? list[0] : [list.slice(0, -1).join(', '), list.slice(-1)].join(' and ');
    }
  </script>
</html>
